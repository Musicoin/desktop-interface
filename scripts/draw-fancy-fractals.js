mscIntf.drawFancyFractals=function(canvas,options){function r(canvas){var options,r,o,a,n,i={first:{x:0,y:1}},l=1,x=1;i.first.next={x:1,y:1};for(var f=0;f<canvas;f++)for(options=i.first;null!=options.next;)r=options.next,n=.33+Math.random()*(1-.66),a=options.x+n*(r.x-options.x),o=.5>n?a-options.x:r.x-a,n=options.y+n*(r.y-options.y),n+=o*(2*Math.random()-1),o={x:a,y:n},n<l?l=n:n>x&&(x=n),o.next=r,options.next=o,options=r;if(x!=l)for(canvas=1/(x-l),options=i.first;null!=options;)options.y=canvas*(options.y-l),options=options.next;else for(options=i.first;null!=options;)options.y=1,options=options.next;return i}function o(canvas,options,o,a,n,i,l){for(var x,f=Math.pow(2,i),h=0,y="rgba("+o.r+","+o.g+","+o.b+",",s=(1-2*Math.random())*a,p=.5*(options.x0+options.x1),g=.5*(options.y0+options.y1),d=options.x0-p,u=options.y0-g,c=Math.sin(s),v=Math.cos(s),b=v*d-c*u,m=c*d+v*u,w=canvas.createLinearGradient(p+b,g+m,p-b,g-m),M=r(i),C=M.first;null!=C;)x=o.a+C.y*n,x<l?x=0:x>1&&(x=1),w.addColorStop(h/f,y+x+")"),h++,C=C.next;return w}canvas.width=options.w,canvas.height=options.h,function(){for(var r=canvas.getContext("2d"),a=options.x0||0,n=options.y0||0,i=a+options.w/2,l=n+options.h/2,x=12,f=0;f<x;f++)r.globalCompositeOperation=options.composite||"lighter",r.fillStyle=o(r,{x0:i,y0:l-1.1*options.h/2,x1:i,y1:l+1.1*options.h/2},{r:options.r||0,g:options.g||0,b:options.b||0,a:options.initAlpha||0},options.angleDev||Math.PI/3,options.alphaDev||.15,options.gradientIter||8,options.alphaZero||.5/255),r.fillRect(a,n,options.w,options.h);r.globalCompositeOperation="destination-over",r.fillStyle=options.bkg||"#ff0000",r.fillRect(a,n,options.w,options.h),r.globalCompositeOperation="source-over"}();return canvas.toDataURL('image/png')};
